<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‡¦ğŸ‡º 2025 Dec Brisbane & Gold Coast â˜€ï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #f0f4f8; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        [v-cloak] { display: none; }
        
        /* å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* ç»ç’ƒæ“¬æ…‹ */
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .glass-dark { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); }
    </style>
</head>
<body>

<div id="app" class="relative min-h-screen pb-24 max-w-md mx-auto bg-gray-50 shadow-2xl overflow-hidden" v-cloak>
    
    <header class="relative h-[280px]">
        <img src="https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?q=80&w=800&auto=format&fit=crop" 
             class="w-full h-full object-cover">
        <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-transparent to-gray-50"></div>
        
        <div class="absolute bottom-6 left-6 right-6">
            <span class="bg-yellow-400 text-blue-900 text-xs font-bold px-2 py-1 rounded-md mb-2 inline-block shadow-sm">TRIP PLANNER</span>
            <h1 class="text-4xl font-extrabold text-white drop-shadow-lg leading-tight">
                2025 Dec<br>Queensland
            </h1>
        </div>

        <button @click="isSyncModalOpen = true" class="absolute top-4 right-4 bg-white/30 backdrop-blur-md text-white p-2 rounded-full shadow-lg active:scale-95 transition">
            <span class="material-icons">cloud_sync</span>
        </button>
    </header>

    <div class="px-6 -mt-8 relative z-20 mb-6">
        <div class="bg-white rounded-2xl shadow-xl p-1.5 flex justify-between items-center">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id"
                :class="currentTab === tab.id ? 'bg-blue-600 text-white shadow-md' : 'text-gray-400 hover:bg-gray-50'"
                class="flex-1 py-3 rounded-xl transition-all duration-300 flex items-center justify-center">
                <span class="material-icons">{{ tab.icon }}</span>
            </button>
        </div>
    </div>

    <main class="px-5">
        
        <section v-show="currentTab === 'schedule'">
            <div class="flex overflow-x-auto no-scrollbar gap-3 mb-6 pb-2">
                <button v-for="(day, index) in itinerary" :key="index" @click="currentDayIndex = index"
                    :class="currentDayIndex === index ? 'bg-blue-600 text-white ring-4 ring-blue-100' : 'bg-white text-gray-500 border border-gray-100'"
                    class="flex-shrink-0 w-[70px] h-[85px] flex flex-col items-center justify-center rounded-2xl transition-all shadow-sm">
                    <span class="text-xs font-medium opacity-80 uppercase tracking-wide">{{ day.date.split(' ')[0] }}</span>
                    <span class="text-2xl font-bold mt-1">{{ day.date.split(' ')[1] }}</span>
                </button>
            </div>

            <div v-if="currentDay" class="bg-gradient-to-r from-blue-500 to-blue-400 rounded-3xl p-5 text-white shadow-lg mb-8 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 w-32 h-32 bg-white/20 rounded-full blur-2xl"></div>
                <div class="flex items-center justify-between relative z-10">
                    <div>
                        <div class="text-blue-100 text-sm font-medium mb-1 flex items-center">
                            <span class="material-icons text-sm mr-1">place</span> {{ currentDay.weather.location }}
                        </div>
                        <div class="text-4xl font-bold tracking-tight">{{ currentDay.weather.temp }}Â°</div>
                        <div class="text-blue-100 text-xs mt-1">é«”æ„Ÿ {{ currentDay.weather.feels_like }}Â°</div>
                    </div>
                    <div class="text-right">
                        <span class="material-icons text-6xl opacity-90 drop-shadow-md">
                            {{ getWeatherIcon(currentDay.weather.condition) }}
                        </span>
                        <div class="text-sm font-bold mt-1">{{ getWeatherLabel(currentDay.weather.condition) }}</div>
                    </div>
                </div>
            </div>

            <div v-if="currentDay" class="relative pl-4 space-y-8">
                <div class="absolute left-[19px] top-4 bottom-0 w-0.5 bg-gray-200"></div>

                <div v-for="(activity, index) in currentDay.activities" :key="activity.id" class="relative group" @click="editActivity(currentDayIndex, index)">
                    <div class="absolute -left-[30px] top-0 bg-white border-2 border-blue-500 w-10 h-10 rounded-full flex items-center justify-center z-10 shadow-sm text-[10px] font-bold text-blue-800 leading-tight text-center">
                        {{ activity.time.split(' ')[0] }}
                    </div>

                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 active:scale-[0.98] transition-transform duration-200">
                        <div class="flex justify-between items-start mb-3">
                            <span :class="getCategoryColor(activity.category)" class="px-2 py-1 rounded-md text-[10px] font-bold text-white shadow-sm">
                                {{ activity.category }}
                            </span>
                            <div class="flex space-x-2">
                                <button @click.stop="openGoogleMaps(activity.location)" class="text-gray-400 hover:text-blue-500">
                                    <span class="material-icons text-lg">near_me</span>
                                </button>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <div v-if="activity.image" class="w-20 h-20 rounded-xl bg-gray-100 flex-shrink-0 bg-cover bg-center shadow-inner" :style="{backgroundImage: 'url(' + activity.image + ')'}"></div>
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-gray-800 text-lg leading-tight mb-1 truncate">{{ activity.name }}</h3>
                                <p class="text-xs text-gray-500 line-clamp-2 mb-2 bg-gray-50 p-1.5 rounded-lg">{{ activity.notes || 'ç„¡å‚™è¨»' }}</p>
                            </div>
                        </div>

                        <div v-if="activity.transport && index < currentDay.activities.length - 1" class="mt-3 pt-3 border-t border-dashed border-gray-200 flex items-center text-xs text-gray-400">
                            <span class="material-icons text-sm mr-1">{{ activity.transport.icon }}</span>
                            <span>å‰å¾€ä¸‹ä¸€ç«™ç´„ {{ activity.transport.time }}</span>
                        </div>
                    </div>
                </div>

                <div v-if="currentDay.activities.length === 0" class="text-center py-10 text-gray-400">
                    <span class="material-icons text-4xl mb-2">event_note</span>
                    <p>ä»Šå¤©é‚„æ²’æœ‰å®‰æ’è¡Œç¨‹</p>
                </div>
            </div>
            
            <div class="h-24"></div>
        </section>

        <section v-show="currentTab === 'expense'">
            <div class="bg-gray-900 rounded-3xl p-6 text-white shadow-xl mb-6 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-32 h-32 bg-yellow-400 rounded-full blur-3xl opacity-20"></div>
                <p class="text-gray-400 text-sm mb-1">ç¸½æ”¯å‡º (AUD)</p>
                <p class="text-4xl font-bold">${{ totalExpenses.toFixed(2) }}</p>
            </div>
            <div class="space-y-3">
                <div v-for="(exp, index) in expenseList" :key="index" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mr-3 text-lg font-bold">
                            {{ exp.name.charAt(0) }}
                        </div>
                        <div>
                            <div class="font-bold text-gray-800">{{ exp.name }}</div>
                            <div class="text-xs text-gray-400">{{ exp.date }} Â· {{ exp.category }}</div>
                        </div>
                    </div>
                    <div class="font-bold text-gray-900">- ${{ exp.amount }}</div>
                </div>
            </div>
        </section>

        <section v-show="currentTab === 'info'" class="space-y-4">
             <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-blue-500">
                 <h3 class="font-bold text-lg mb-2">èˆªç­è³‡è¨Š</h3>
                 <div class="space-y-2 text-sm">
                     <div class="flex justify-between"><span class="text-gray-500">å»ç¨‹</span> <span class="font-bold">{{ flightInfo.depart.time }}</span></div>
                     <div class="flex justify-between"><span class="text-gray-500">å›ç¨‹</span> <span class="font-bold">{{ flightInfo.return.time }}</span></div>
                 </div>
             </div>
             <div class="bg-white p-5 rounded-2xl shadow-sm border-l-4 border-green-500">
                <h3 class="font-bold text-lg mb-2">ä½å®¿è³‡è¨Š</h3>
                <div v-for="(info, key) in accommodationInfo" :key="key" class="mb-3 pb-3 border-b last:border-0 last:pb-0">
                    <p class="text-xs font-bold text-green-600 uppercase">{{ info.city }}</p>
                    <p class="font-bold">{{ info.name }}</p>
                </div>
                <button @click="openAccommodationModal" class="w-full mt-2 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-bold">ç·¨è¼¯ä½å®¿</button>
            </div>
        </section>

        <section v-show="currentTab === 'shopping'">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, index) in shoppingList" :key="index" class="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 relative">
                    <button @click="removeShoppingItem(index)" class="absolute -top-2 -right-2 bg-red-100 text-red-500 w-6 h-6 rounded-full flex items-center justify-center"><span class="material-icons text-xs">close</span></button>
                    <div v-if="item.image" class="h-28 w-full bg-gray-100 rounded-xl mb-2 bg-cover bg-center" :style="{backgroundImage: 'url(' + item.image + ')'}"></div>
                    <div v-else class="h-28 bg-gray-50 rounded-xl mb-2 flex items-center justify-center text-gray-300"><span class="material-icons">image</span></div>
                    <p class="font-bold text-gray-800 text-sm text-center">{{ item.name }}</p>
                </div>
            </div>
        </section>

    </main>

    <button v-show="currentTab === 'schedule' || currentTab === 'shopping' || currentTab === 'expense'" 
        @click="handleFabClick" 
        class="fixed bottom-6 right-6 w-14 h-14 bg-black text-white rounded-full shadow-2xl z-40 flex items-center justify-center transform active:scale-90 transition hover:bg-gray-800">
        <span class="material-icons text-2xl">add</span>
    </button>

    <div v-if="isSyncModalOpen" class="fixed inset-0 glass-dark z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full p-6 shadow-2xl animate-fade-in">
            <h3 class="text-xl font-bold mb-4 flex items-center"><span class="material-icons mr-2">save</span> è³‡æ–™å‚™ä»½</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">åŒ¯å‡ºè³‡æ–™ (Export)</label>
                    <button @click="exportData" class="w-full mt-1 py-3 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl font-bold text-sm flex items-center justify-center">
                        <span class="material-icons text-sm mr-2">content_copy</span> è¤‡è£½è³‡æ–™ä»£ç¢¼åˆ°å‰ªè²¼ç°¿
                    </button>
                </div>
                
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">é‚„åŸè³‡æ–™ (Import)</label>
                    <textarea v-model="importDataString" placeholder="è²¼ä¸Šä»£ç¢¼..." class="w-full mt-1 p-3 bg-gray-50 border border-gray-200 rounded-xl text-xs h-24 focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                    <button @click="importData" class="w-full mt-2 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-500/30">
                        åŸ·è¡Œé‚„åŸ
                    </button>
                </div>
            </div>
            <button @click="isSyncModalOpen = false" class="w-full mt-6 py-3 text-gray-400 font-bold text-sm">é—œé–‰</button>
        </div>
    </div>

    <div v-if="isActivityModalOpen" class="fixed inset-0 glass-dark z-50 flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white rounded-t-3xl sm:rounded-3xl w-full h-[85vh] sm:h-auto p-6 overflow-y-auto animate-slide-up shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">{{ editingActivityIndex === null ? 'âœ¨ æ–°å¢è¡Œç¨‹' : 'âœï¸ ç·¨è¼¯è¡Œç¨‹' }}</h3>
                <button @click="isActivityModalOpen = false" class="text-gray-400"><span class="material-icons">close</span></button>
            </div>
            
            <div class="space-y-4">
                <div class="w-full h-40 bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200 relative flex items-center justify-center overflow-hidden">
                    <img v-if="activityForm.image" :src="activityForm.image" class="absolute inset-0 w-full h-full object-cover">
                    <div class="text-center text-gray-400 pointer-events-none">
                        <span class="material-icons">add_photo_alternate</span>
                        <p class="text-xs">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¸Šå‚³</p>
                    </div>
                </div>
                <input type="file" @change="handleActivityImageUpload" class="text-sm text-gray-500">

                <input v-model="activityForm.name" placeholder="è¡Œç¨‹åç¨±" class="w-full p-4 bg-gray-50 rounded-xl font-bold text-lg outline-none focus:bg-white focus:ring-2 focus:ring-blue-100">
                
                <div class="flex gap-3">
                    <select v-model="activityForm.category" class="w-1/2 p-3 bg-gray-50 rounded-xl outline-none">
                        <option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>ä½å®¿</option><option>äº¤é€š</option><option>èˆªç­</option>
                    </select>
                    <input v-model="activityForm.time" placeholder="æ™‚é–“ (ä¾‹å¦‚ 14:00)" class="w-1/2 p-3 bg-gray-50 rounded-xl outline-none">
                </div>

                <input v-model="activityForm.location" placeholder="åœ°é» (ä¾›åœ°åœ–å°èˆªç”¨)" class="w-full p-4 bg-gray-50 rounded-xl outline-none">
                <textarea v-model="activityForm.notes" placeholder="å‚™è¨»..." class="w-full p-4 bg-gray-50 rounded-xl outline-none h-24 resize-none"></textarea>
            </div>

            <div class="flex gap-3 mt-8">
                <button v-if="editingActivityIndex !== null" @click="confirmDeleteActivity" class="flex-1 py-3 bg-red-50 text-red-500 rounded-xl font-bold">åˆªé™¤</button>
                <button @click="saveActivity" class="flex-[2] py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-500/30">å„²å­˜è¡Œç¨‹</button>
            </div>
        </div>
    </div>

    <div v-if="isAccommodationModalOpen" class="fixed inset-0 glass-dark z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full p-6">
            <h3 class="font-bold mb-4">ç·¨è¼¯ä½å®¿</h3>
            <div v-for="(info, key) in accommodationInfo" :key="key" class="mb-4">
                <p class="text-xs font-bold text-blue-500 mb-1">{{ info.city }}</p>
                <input v-model="info.name" class="w-full p-2 bg-gray-50 rounded-lg mb-2" placeholder="é£¯åº—åç¨±">
            </div>
            <div class="flex gap-2"><button @click="isAccommodationModalOpen=false" class="flex-1 py-2 bg-gray-100 rounded-lg">å–æ¶ˆ</button><button @click="saveAccommodation" class="flex-1 py-2 bg-blue-600 text-white rounded-lg">å„²å­˜</button></div>
        </div>
    </div>

    <div v-if="isShoppingModalOpen" class="fixed inset-0 glass-dark z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full p-6">
            <h3 class="font-bold mb-4">æ–°å¢è³¼ç‰©é …ç›®</h3>
            <input v-model="shoppingForm.name" placeholder="å•†å“åç¨±" class="w-full p-3 bg-gray-50 rounded-xl mb-4">
            <input type="file" @change="handleImageUpload" class="mb-4 text-sm">
            <div class="flex gap-2"><button @click="isShoppingModalOpen=false" class="flex-1 py-2 bg-gray-100 rounded-lg">å–æ¶ˆ</button><button @click="addShoppingItem" class="flex-1 py-2 bg-black text-white rounded-lg">æ–°å¢</button></div>
        </div>
    </div>

    <div v-if="isExpenseModalOpen" class="fixed inset-0 glass-dark z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl w-full p-6">
            <h3 class="font-bold mb-4">è¨˜å¸³</h3>
            <input v-model="expenseForm.name" placeholder="é …ç›®" class="w-full p-3 bg-gray-50 rounded-xl mb-2">
            <input v-model="expenseForm.amount" type="number" placeholder="é‡‘é¡" class="w-full p-3 bg-gray-50 rounded-xl mb-2">
            <select v-model="expenseForm.category" class="w-full p-3 bg-gray-50 rounded-xl mb-4"><option>é£²é£Ÿ</option><option>äº¤é€š</option><option>è³¼ç‰©</option><option>å…¶ä»–</option></select>
            <div class="flex gap-2"><button @click="isExpenseModalOpen=false" class="flex-1 py-2 bg-gray-100 rounded-lg">å–æ¶ˆ</button><button @click="addExpense" class="flex-1 py-2 bg-black text-white rounded-lg">æ–°å¢</button></div>
        </div>
    </div>

</div>

<script>
const { createApp, ref, reactive, computed } = Vue;

createApp({
    setup() {
        const load = (k, d) => { try { return JSON.parse(localStorage.getItem(k)) || d; } catch(e) { return d; }};
        const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

        const tabs = [
            { id: 'schedule', icon: 'calendar_today' }, 
            { id: 'info', icon: 'airplane_ticket' }, 
            { id: 'shopping', icon: 'shopping_bag' }, 
            { id: 'expense', icon: 'receipt_long' }
        ];
        const currentTab = ref('schedule');
        const currentDayIndex = ref(0);

        // ğŸŒ§ï¸ å¤©æ°£é‚è¼¯ï¼šæ”¯æ´ sunny, rain, cloudy, storm
        const defaultItinerary = [
            { date: 'Tue 09', weather: {condition:'sunny', temp:25, feels_like:25, location:'Gold Coast'}, activities: [
                { id: 1, name: 'æŠµé”é»ƒé‡‘æµ·å²¸æ©Ÿå ´', category: 'èˆªç­', time: '09:40', notes: 'VA528', location: 'Gold Coast Airport', transport:{icon:'directions_bus', time:'1h'}, image: 'https://images.unsplash.com/photo-1597818967926-d249f05a1e28?q=80&w=400' },
                { id: 2, name: 'é£¯åº— Check-in', category: 'ä½å®¿', time: '12:00', notes: 'æ”¾è¡Œæ', location: 'Brisbane CBD', transport:null, image:'' }
            ]},
            { date: 'Wed 10', weather: {condition:'rain', temp:23, feels_like:25, location:'Moreton Is.'}, activities: [
                { id: 3, name: 'å‰å¾€ç¢¼é ­', category: 'äº¤é€š', time: '08:30', notes: 'è¨˜å¾—å¸¶é›¨å…·', location: 'Holt Street Wharf', transport:{icon:'directions_boat', time:'75m'}, image: 'https://images.unsplash.com/photo-1510097467424-192d713fd8b2?q=80&w=400' },
                { id: 4, name: 'é¤µé£Ÿæµ·è±š', category: 'æ™¯é»', time: '18:00', notes: 'ä¸‹é›¨ç…§å¸¸é€²è¡Œ', location: 'Tangalooma', transport:null, image:'https://images.unsplash.com/photo-1570481662006-a3a1374699e8?q=80&w=400' }
            ]},
            { date: 'Thu 11', weather: {condition:'cloudy', temp:26, feels_like:28, location:'Theme Park'}, activities: [] },
            { date: 'Fri 12', weather: {condition:'sunny', temp:28, feels_like:30, location:'Beach'}, activities: [] }
        ];

        const itinerary = reactive(load('itinerary_v9', defaultItinerary));
        const currentDay = computed(() => itinerary[currentDayIndex.value]);

        // ğŸŒ§ï¸ å¤©æ°£åœ–æ¨™å°æ‡‰å‡½æ•¸
        const getWeatherIcon = (c) => {
            const map = { 'sunny': 'wb_sunny', 'rain': 'umbrella', 'cloudy': 'wb_cloudy', 'storm': 'thunderstorm' };
            return map[c] || 'wb_sunny';
        };
        const getWeatherLabel = (c) => {
            const map = { 'sunny': 'æ™´æœ—', 'rain': 'ä¸‹é›¨', 'cloudy': 'å¤šé›²', 'storm': 'é›·é›¨' };
            return map[c] || c;
        };

        // é¡è‰²ç®¡ç†
        const getCategoryColor = (cat) => {
            const colors = { 'èˆªç­': 'bg-yellow-500', 'ä½å®¿': 'bg-green-500', 'æ™¯é»': 'bg-blue-500', 'ç¾é£Ÿ': 'bg-red-400', 'è³¼ç‰©': 'bg-purple-400', 'äº¤é€š': 'bg-gray-400' };
            return colors[cat] || 'bg-gray-400';
        };

        // Modal æ§åˆ¶
        const isSyncModalOpen = ref(false);
        const importDataString = ref('');
        const isActivityModalOpen = ref(false);
        const editingActivityIndex = ref(null);
        const activityForm = reactive({ name:'', category:'æ™¯é»', time:'', notes:'', location:'', image: '' });
        
        const openGoogleMaps = (loc) => loc ? window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`) : alert('æœªè¨­å®šåœ°é»');

        // CRUD æ“ä½œ
        const editActivity = (dayIdx, actIdx) => { editingActivityIndex.value = actIdx; Object.assign(activityForm, itinerary[dayIdx].activities[actIdx]); isActivityModalOpen.value = true; };
        const saveActivity = () => {
            if (editingActivityIndex.value === null) itinerary[currentDayIndex.value].activities.push({...activityForm, id: Date.now()});
            else Object.assign(itinerary[currentDayIndex.value].activities[editingActivityIndex.value], activityForm);
            save('itinerary_v9', itinerary); isActivityModalOpen.value = false;
        };
        const confirmDeleteActivity = () => { if(confirm('ç¢ºå®šåˆªé™¤?')) { itinerary[currentDayIndex.value].activities.splice(editingActivityIndex.value, 1); save('itinerary_v9', itinerary); isActivityModalOpen.value = false; }};
        const handleActivityImageUpload = (e) => { const r = new FileReader(); r.onload = x => activityForm.image = x.target.result; if(e.target.files[0]) r.readAsDataURL(e.target.files[0]); };

        // FAB æŒ‰éˆ•é‚è¼¯
        const handleFabClick = () => {
            if(currentTab.value === 'schedule') { editingActivityIndex.value = null; Object.assign(activityForm, {name:'', category:'æ™¯é»', time:'', notes:'', location:'', image:''}); isActivityModalOpen.value = true; }
            else if(currentTab.value === 'shopping') openNewShoppingModal();
            else if(currentTab.value === 'expense') openNewExpenseModal();
        };

        // å…¶ä»–æ•¸æ“šèˆ‡Modal (ç°¡åŒ–ç¶å®š)
        const accommodationInfo = reactive(load('accom_v9', { brisbane: {city:'Brisbane', name:'å¾…å¡«å¯«'}, gc: {city:'Gold Coast', name:'å¾…å¡«å¯«'} }));
        const isAccommodationModalOpen = ref(false);
        const saveAccommodation = () => { save('accom_v9', accommodationInfo); isAccommodationModalOpen.value = false; };
        const openAccommodationModal = () => isAccommodationModalOpen.value = true;

        const shoppingList = reactive(load('shop_v9', []));
        const isShoppingModalOpen = ref(false);
        const shoppingForm = reactive({ name:'', image: null });
        const openNewShoppingModal = () => { shoppingForm.name=''; shoppingForm.image=null; isShoppingModalOpen.value = true; };
        const handleImageUpload = (e) => { const r = new FileReader(); r.onload=x=>shoppingForm.image=x.target.result; if(e.target.files[0]) r.readAsDataURL(e.target.files[0]); };
        const addShoppingItem = () => { shoppingList.push({...shoppingForm}); save('shop_v9', shoppingList); isShoppingModalOpen.value = false; };
        const removeShoppingItem = (i) => { shoppingList.splice(i, 1); save('shop_v9', shoppingList); };

        const expenseList = reactive(load('exp_v9', []));
        const isExpenseModalOpen = ref(false);
        const expenseForm = reactive({ category:'é£²é£Ÿ', name:'', amount:0, date: new Date().toISOString().split('T')[0] });
        const openNewExpenseModal = () => { expenseForm.name=''; expenseForm.amount=''; isExpenseModalOpen.value = true; };
        const addExpense = () => { expenseList.push({...expenseForm}); save('exp_v9', expenseList); isExpenseModalOpen.value = false; };
        const totalExpenses = computed(() => expenseList.reduce((sum, i) => sum + Number(i.amount||0), 0));

        const flightInfo = { depart: {time:'09:40', flight:'VA511'}, return: {time:'14:50', flight:'VA528'} };

        // â˜ï¸ å‚™ä»½é‚è¼¯å„ªåŒ–
        const exportData = () => {
            const data = JSON.stringify({ itinerary, accommodationInfo, shoppingList, expenseList });
            navigator.clipboard.writeText(data)
                .then(() => alert('âœ… è³‡æ–™ä»£ç¢¼å·²è¤‡è£½ï¼\nè«‹è²¼ä¸Šåˆ°å…¶ä»–è£ç½®çš„ã€Œé‚„åŸè³‡æ–™ã€æ¡†ä¸­ã€‚'))
                .catch(() => prompt("è‡ªå‹•è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹ä»£ç¢¼ï¼š", data));
        };
        const importData = () => {
            try {
                const d = JSON.parse(importDataString.value);
                if(d.itinerary) {
                    Object.assign(itinerary, d.itinerary);
                    Object.assign(accommodationInfo, d.accommodationInfo);
                    shoppingList.splice(0, shoppingList.length, ...d.shoppingList);
                    expenseList.splice(0, expenseList.length, ...d.expenseList);
                    save('itinerary_v9', itinerary); save('accom_v9', accommodationInfo); save('shop_v9', shoppingList); save('exp_v9', expenseList);
                    alert('âœ… è³‡æ–™é‚„åŸæˆåŠŸï¼'); isSyncModalOpen.value = false;
                } else alert('âŒ ä»£ç¢¼æ ¼å¼éŒ¯èª¤');
            } catch(e) { alert('âŒ ç„¡æ•ˆçš„ä»£ç¢¼'); }
        };

        return {
            tabs, currentTab, currentDayIndex, itinerary, currentDay,
            flightInfo, accommodationInfo, shoppingList, expenseList, totalExpenses,
            isSyncModalOpen, exportData, importData, importDataString,
            isActivityModalOpen, activityForm, editingActivityIndex, editActivity, saveActivity, confirmDeleteActivity, handleActivityImageUpload,
            handleFabClick, getWeatherIcon, getWeatherLabel, getCategoryColor, openGoogleMaps,
            isAccommodationModalOpen, openAccommodationModal, saveAccommodation,
            isShoppingModalOpen, shoppingForm, openNewShoppingModal, handleImageUpload, addShoppingItem, removeShoppingItem,
            isExpenseModalOpen, expenseForm, openNewExpenseModal, addExpense
        };
    }
}).mount('#app');
</script>
</body>
</html>
