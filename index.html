<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¦ğŸ‡º é™½å…‰é»ƒé‡‘æµ·å²¸ä¹‹æ—… - è¡Œç¨‹è¦åŠƒ App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/4.1.0/vuedraggable.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* æ‡‰ç”¨ç¨‹å¼ä¸»èƒŒæ™¯è‰²ï¼šå¾åœ–ç‰‡åº•éƒ¨æå–çš„è—è‰²/å¤©ç©ºè‰²å»¶ä¼¸ */
        body, #app {
            background-color: #f7f9fc; /* è¼•å¾®çš„æ·¡è—è‰²/ç™½è‰²ï¼Œé©åˆå¸ƒé‡Œæ–¯ç­çš„é™½å…‰æ„Ÿ */
        }
        /* æ¾³æ´²è—å’Œé™½å…‰é»ƒ */
        .color-primary { background-color: #004c8f; } /* æ·±è— */
        .color-secondary { background-color: #ffcd00; } /* é™½å…‰é»ƒ */

        /* è‡ªå®šç¾©åœ“å¼§æ•ˆæœ (èˆ‡é é¦–åœ–ç‰‡éŠœæ¥) */
        .curved-banner-mask {
            /* å‰µå»ºä¸€å€‹èˆ‡ banner é¡è‰²ç›¸åŒçš„å…ƒç´ ä¾†å¯¦ç¾åœ“å¼§ */
            background-color: #004c8f; /* å‡è¨­ banner åº•éƒ¨é‚Šç·£æ˜¯æ·±è—è‰² */
            width: 100%;
            height: 100px; /* åœ“å¼§é«˜åº¦ */
            position: absolute;
            bottom: -50px; /* å°‡åœ“å¼§åº•éƒ¨æ‹‰ä¼¸åˆ°å¤–é¢ */
            border-radius: 0 0 50% 50%; /* åƒ…åº•éƒ¨åœ“å¼§ */
            transform: scaleX(1.5); /* è®“åœ“å¼§æ›´å¹³ç·© */
            z-index: 10;
        }

        /* éš±è—åŸç”Ÿæ»¾å‹•æ¢ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body>

<div id="app" class="relative min-h-screen">
    
    <header class="relative w-full h-[250px] overflow-hidden color-primary">
        <img src="Gemini_Generate" 
             alt="æ¾³æ´²å¸ƒé‡Œæ–¯ç­èˆ‡é»ƒé‡‘æµ·å²¸é™½å…‰æµ·ç˜é¢¨æ ¼æ©«å¹…" 
             class="absolute inset-0 w-full h-full object-cover opacity-75">
        
        <div class="absolute inset-0 flex items-center justify-center">
             <div class="text-4xl font-bold text-white drop-shadow-lg p-2 rounded-lg">
                ğŸ‡¦ğŸ‡º æ˜†å£«è˜­é™½å…‰ä¹‹æ—… â˜€ï¸
             </div>
        </div>
        
        <div class="absolute bottom-0 left-0 right-0 h-10 bg-[#f7f9fc] rounded-t-[50px] z-20" 
             style="transform: translateY(50%);"></div>
    </header>

    <div class="absolute top-[220px] right-4 flex space-x-2 z-30">
        <button v-for="tab in tabs" :key="tab.id"
                @click="currentTab = tab.id"
                :class="{'color-secondary': currentTab === tab.id, 'bg-white text-gray-400': currentTab !== tab.id}"
                class="p-3 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
            <span class="material-icons">{{ tab.icon }}</span>
        </button>
    </div>

    <main class="relative z-10 p-4 -mt-6">
        
        <section v-show="currentTab === 'schedule'">
            ## ğŸ“… æ¯æ—¥è¡Œç¨‹è¡¨

            <div class="flex overflow-x-scroll no-scrollbar py-2 mb-4 space-x-3">
                <button v-for="(day, index) in itinerary" :key="index"
                        @click="currentDayIndex = index"
                        :class="{'color-primary text-white shadow-lg': currentDayIndex === index, 'bg-white text-gray-700 border border-gray-200': currentDayIndex !== index}"
                        class="flex-shrink-0 w-[60px] h-[70px] flex flex-col items-center justify-center p-2 rounded-xl transition duration-300 hover:shadow-md">
                    <span class="text-xs">{{ day.date.substring(0, 3) }}</span> <span class="text-3xl font-bold">{{ day.date.substring(4) }}</span> </button>
            </div>
            
            <div v-if="currentDay" class="space-y-4">
                
                <div class="flex items-center p-3 bg-white rounded-xl shadow-md border-l-4 border-blue-400 text-gray-800">
                    <span class="material-icons text-3xl text-yellow-500 mr-3">wb_sunny</span>
                    <div>
                        <div class="font-bold">{{ currentDay.weather.location }}</div>
                        <div class="text-sm">
                            <span class="text-lg font-semibold">{{ currentDay.weather.temp }}Â°C</span> (é«”æ„Ÿ {{ currentDay.weather.feels_like }}Â°C)
                        </div>
                    </div>
                </div>

                <div class="relative mb-4">
                    <select class="block w-full p-3 border border-gray-300 rounded-xl shadow-sm appearance-none focus:ring-blue-500 focus:border-blue-500">
                        <option>æ‰€æœ‰åˆ†é¡</option>
                        <option>æ™¯é»</option>
                        <option>ä½å®¿</option>
                        <option>ç¾é£Ÿ</option>
                        <option>è³¼ç‰©</option>
                        <option>èˆªç­</option>
                        <option>å…¶ä»–</option>
                    </select>
                </div>
                
                <draggable v-model="currentDay.activities" item-key="id" @end="recalculateTransportTimes" :options="{handle: '.drag-handle'}">
                    <template #item="{element: activity, index}">
                        <div class="mb-4">
                            <div v-if="index === 0 && currentDayIndex === 0" 
                                class="p-4 bg-white rounded-xl shadow-md border-l-4 border-yellow-500">
                                <div class="flex justify-between items-center text-gray-700">
                                    <h3 class="font-bold text-lg flex items-center">
                                        <span class="material-icons mr-2 text-blue-500">flight_land</span> 
                                        {{ activity.name }}
                                    </h3>
                                </div>
                                <div class="mt-2 text-sm space-y-1">
                                    <p>èˆªç­: **{{ flightInfo.return.flight_num }}**</p>
                                    <p>æŠµé”: **{{ flightInfo.return.arrival_time }}** ({{ flightInfo.return.arrival_airport_short }})</p>
                                    <p>é£›è¡Œæ™‚é–“: {{ flightInfo.return.duration }}</p>
                                </div>
                            </div>

                            <div v-else class="relative p-4 bg-white rounded-xl shadow-md border-l-4"
                                :class="{'border-green-500': activity.category === 'ä½å®¿', 'border-blue-500': activity.category === 'æ™¯é»', 'border-red-500': activity.category === 'ç¾é£Ÿ'}"
                                @click="editActivity(currentDayIndex, index)">
                                
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-lg text-gray-800">{{ activity.name }}</h4>
                                    <span class="material-icons text-gray-400 drag-handle cursor-grab">menu</span>
                                </div>

                                <div class="mt-2 text-sm text-gray-600 space-y-1">
                                    <p v-if="activity.time">æ™‚é–“: **{{ activity.time }}**</p>
                                    <p v-if="activity.category === 'æ™¯é»' && activity.price">é–€ç¥¨: **{{ activity.price }}**</p>
                                    <p>å‚™è¨»: {{ activity.notes }}</p>
                                </div>
                                
                                <button @click.stop="openGoogleMaps(activity.location)" 
                                        class="mt-3 text-blue-600 hover:text-blue-800 text-sm font-semibold flex items-center">
                                    <span class="material-icons text-base mr-1">directions</span>
                                    Google Map å°èˆª
                                </button>
                            </div>

                            <div v-if="index < currentDay.activities.length - 1 || (index === 0 && currentDayIndex === 0)" class="flex items-center text-gray-500 mt-2 ml-4">
                                <span class="material-icons text-lg mr-2" :title="activity.transport.type">{{ activity.transport.icon }}</span>
                                <span class="text-sm font-medium">{{ activity.transport.time }}</span>
                            </div>
                        </div>
                    </template>
                </draggable>
            </div>
            
            <button @click="openNewActivityModal"
                    class="fixed bottom-20 right-6 p-4 color-secondary text-white rounded-full shadow-2xl transition duration-300 transform hover:scale-110 z-40">
                <span class="material-icons text-3xl">add</span>
            </button>
        </section>

        <section v-show="currentTab === 'info'" class="space-y-6 p-2">
            ## â„¹ï¸ è³‡è¨Š

            <div class="bg-white p-4 rounded-xl shadow-lg border-l-4 border-blue-500">
                <h3 class="font-bold text-xl mb-3 text-blue-700 flex items-center">
                    <span class="material-icons mr-2">flight</span> èˆªç­è³‡è¨Š
                </h3>
                
                <div class="border-b pb-3 mb-3">
                    <h4 class="font-semibold text-lg mb-2">å»ç¨‹: å°ç£ (TPE) â†’ å¢¨çˆ¾æœ¬ (MEL)</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <p><span class="font-medium">èµ·é£›/æŠµé”:</span> {{ flightInfo.depart.departure_time }} / {{ flightInfo.depart.arrival_time }}</p>
                        <p><span class="font-medium">èˆªç­ç·¨è™Ÿ:</span> **{{ flightInfo.depart.flight_num }}**</p>
                        <p><span class="font-medium">é£›è¡Œæ™‚é–“:</span> {{ flightInfo.depart.duration }}</p>
                        <p><span class="font-medium">èµ·é£›æ©Ÿå ´:</span> {{ flightInfo.depart.departure_airport }}</p>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-lg mb-2">å›ç¨‹: é»ƒé‡‘æµ·å²¸ (OOL) â†’ å°ç£ (TPE)</h4>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <p><span class="font-medium">èµ·é£›/æŠµé”:</span> {{ flightInfo.return.departure_time }} / {{ flightInfo.return.arrival_time }}</p>
                        <p><span class="font-medium">èˆªç­ç·¨è™Ÿ:</span> **{{ flightInfo.return.flight_num }}**</p>
                        <p><span class="font-medium">é£›è¡Œæ™‚é–“:</span> {{ flightInfo.return.duration }}</p>
                        <p><span class="font-medium">æŠµé”æ©Ÿå ´:</span> {{ flightInfo.return.arrival_airport }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-lg border-l-4 border-green-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-xl text-green-700 flex items-center">
                        <span class="material-icons mr-2">hotel</span> ä½å®¿è³‡è¨Š
                    </h3>
                    <button @click="openAccommodationModal" class="text-sm text-blue-500 hover:text-blue-700 font-semibold">
                        <span class="material-icons text-base">edit</span> ç·¨è¼¯
                    </button>
                </div>
                
                <div v-for="(info, key) in accommodationInfo" :key="key" class="border-b last:border-b-0 pb-2 mb-2 last:mb-0">
                    <h4 class="font-semibold text-lg mb-1">{{ info.city }} ä½å®¿</h4>
                    <p class="text-sm text-gray-700">
                        <span class="font-medium">åç¨±:</span> **{{ info.name || 'å¾…å®š' }}**
                    </p>
                    <p v-if="info.phone" class="text-sm text-gray-700">
                        <span class="font-medium">é›»è©±:</span> <a :href="'tel:' + info.phone" class="text-blue-600">{{ info.phone }}</a>
                    </p>
                    <p v-if="info.address" class="text-sm text-gray-700">
                        <span class="font-medium">åœ°å€:</span> {{ info.address }}
                    </p>
                    <a v-if="info.address" :href="'https://www.google.com/maps/search/?api=1&query=' + info.address" target="_blank" class="text-xs text-blue-500 hover:underline flex items-center mt-1">
                        <span class="material-icons text-sm mr-1">location_on</span> å°èˆªé€£çµ
                    </a>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-lg border-l-4 border-red-500">
                <h3 class="font-bold text-xl mb-3 text-red-700 flex items-center">
                    <span class="material-icons mr-2">emergency</span> ç·Šæ€¥é€£çµ¡
                </h3>
                <p class="text-sm">åœ¨æ¾³æ´²ï¼Œæ‰€æœ‰ç·Šæ€¥æœå‹™ï¼ˆè­¦å¯Ÿã€æ•‘è­·è»Šã€æ¶ˆé˜²ï¼‰çš„é›»è©±è™Ÿç¢¼æ˜¯ï¼š</p>
                <p class="text-2xl font-bold mt-2 text-red-600">
                    <a href="tel:000">000</a>
                </p>
                <p class="text-xs mt-1 text-gray-500">
                    <span class="font-medium">éç·Šæ€¥è­¦å¯Ÿæœå‹™ (Police Assistance Line):</span> 131 444
                </p>
            </div>
        </section>

        <section v-show="currentTab === 'shopping'" class="p-2">
            ## ğŸ›ï¸ è³¼ç‰©æ¸…å–®

            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, index) in shoppingList" :key="index"
                     class="bg-white p-3 rounded-xl shadow-md border-b-4 border-pink-300">
                    <img v-if="item.image" :src="item.image" :alt="item.name" 
                         class="w-full h-24 object-cover rounded-lg mb-2">
                    <p class="font-semibold text-gray-800">{{ item.name }}</p>
                    <button @click="removeShoppingItem(index)" class="text-red-400 text-xs mt-1 hover:text-red-600">
                        åˆªé™¤
                    </button>
                </div>
            </div>

            <button @click="openNewShoppingModal"
                    class="fixed bottom-20 right-6 p-4 color-secondary text-white rounded-full shadow-2xl transition duration-300 transform hover:scale-110 z-40">
                <span class="material-icons text-3xl">add</span>
            </button>
        </section>

        <section v-show="currentTab === 'expense'" class="p-2">
            ## ğŸ’° èŠ±è²»è¨˜éŒ„

            <div class="bg-white p-4 rounded-xl shadow-lg mb-4 flex justify-between items-center border-l-4 border-yellow-500">
                <span class="text-lg font-medium text-gray-700">ç¸½èŠ±è²» (AUD)</span>
                <span class="text-3xl font-bold color-primary text-white p-2 rounded-lg">
                    ${{ totalExpenses.toFixed(2) }}
                </span>
            </div>

            <div class="space-y-3">
                <div v-for="(expense, index) in expenseList" :key="index"
                     class="bg-white p-3 rounded-xl shadow-md border-l-4"
                     :class="{'border-blue-500': expense.category === 'äº¤é€š', 'border-red-500': expense.category === 'é£²é£Ÿ', 'border-green-500': expense.category === 'ä½å®¿'}">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-lg text-gray-800">{{ expense.name }}</span>
                        <span class="text-xl font-bold text-red-600">${{ expense.amount.toFixed(2) }}</span>
                    </div>
                    <div class="text-sm text-gray-600">
                        <span class="font-medium">{{ expense.category }}</span> | 
                        {{ expense.date }} | 
                        {{ expense.payment }}
                    </div>
                </div>
            </div>

            <button @click="openNewExpenseModal"
                    class="fixed bottom-20 right-6 p-4 color-secondary text-white rounded-full shadow-2xl transition duration-300 transform hover:scale-110 z-40">
                <span class="material-icons text-3xl">add</span>
            </button>
        </section>
    </main>

    <div v-if="isActivityModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 text-gray-800">{{ editingActivityIndex === null ? 'æ–°å¢è¡Œç¨‹' : 'ç·¨è¼¯è¡Œç¨‹' }}</h3>
            <form @submit.prevent="saveActivity" class="space-y-4">
                
                <input type="text" v-model="activityForm.name" placeholder="åç¨±" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                
                <select v-model="activityForm.category" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <option value="" disabled>-- é¸æ“‡åˆ†é¡ --</option>
                    <option value="æ™¯é»">æ™¯é»</option>
                    <option value="ä½å®¿">ä½å®¿</option>
                    <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
                    <option value="è³¼ç‰©">è³¼ç‰©</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>

                <input type="text" v-model="activityForm.time" placeholder="æ™‚é–“ (Ex: 13:30 - 16:30)"
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <input v-if="activityForm.category === 'æ™¯é»'" type="text" v-model="activityForm.price" placeholder="é–€ç¥¨è²»ç”¨ (Ex: $49 AUD)"
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <textarea v-model="activityForm.notes" placeholder="ç‰¹è‰²èˆ‡å‚™è¨»" rows="3"
                          class="w-full p-3 border border-gray-300 rounded-lg"></textarea>
                
                <input type="text" v-model="activityForm.location" placeholder="Google Maps æŸ¥è©¢åœ°é» (Ex: Q1 SkyPoint)" required
                       class="w-full p-3 border border-gray-300 rounded-lg">

                <div class="flex justify-end space-x-3 mt-5">
                    <button type="button" @click="isActivityModalOpen = false" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="py-2 px-4 color-primary text-white rounded-lg hover:opacity-90">
                        {{ editingActivityIndex === null ? 'æ–°å¢' : 'å„²å­˜ä¿®æ”¹' }}
                    </button>
                </div>
                
                <button v-if="editingActivityIndex !== null" @click="confirmDeleteActivity" type="button"
                        class="w-full py-2 px-4 bg-red-500 text-white rounded-lg mt-3 hover:bg-red-600">
                    åˆªé™¤è¡Œç¨‹
                </button>
            </form>
        </div>
    </div>
    
    <div v-if="isAccommodationModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 text-gray-800">ç·¨è¼¯ä½å®¿è³‡è¨Š</h3>
            <form @submit.prevent="saveAccommodation" class="space-y-4">
                
                <div v-for="(info, city) in accommodationInfo" :key="city" class="border p-3 rounded-lg">
                    <h4 class="font-semibold mb-2">{{ info.city }} ä½å®¿</h4>
                    <input type="text" v-model="info.name" placeholder="é£¯åº—åç¨±"
                           class="w-full p-2 border border-gray-300 rounded-lg mb-2">
                    <input type="tel" v-model="info.phone" placeholder="é›»è©±"
                           class="w-full p-2 border border-gray-300 rounded-lg mb-2">
                    <input type="text" v-model="info.address" placeholder="åœ°å€ (ç”¨æ–¼å°èˆª)"
                           class="w-full p-2 border border-gray-300 rounded-lg">
                </div>

                <div class="flex justify-end space-x-3 mt-5">
                    <button type="button" @click="isAccommodationModalOpen = false" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="py-2 px-4 color-primary text-white rounded-lg hover:opacity-90">
                        å„²å­˜ä¿®æ”¹
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div v-if="isShoppingModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 text-gray-800">æ–°å¢è³¼ç‰©é …ç›®</h3>
            <form @submit.prevent="addShoppingItem" class="space-y-4">
                
                <input type="text" v-model="shoppingForm.name" placeholder="å•†å“åç¨±" required
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <label class="block text-sm font-medium text-gray-700">å•†å“åœ–ç‰‡ (åƒ…é™ Base64 æˆ– URL)</label>
                <input type="file" @change="handleImageUpload" accept="image/*"
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <div class="flex justify-end space-x-3 mt-5">
                    <button type="button" @click="isShoppingModalOpen = false" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="py-2 px-4 color-primary text-white rounded-lg hover:opacity-90">
                        æ–°å¢
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div v-if="isExpenseModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl">
            <h3 class="text-2xl font-bold mb-4 text-gray-800">æ–°å¢èŠ±è²»è¨˜éŒ„</h3>
            <form @submit.prevent="addExpense" class="space-y-4">
                
                <select v-model="expenseForm.category" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <option value="" disabled>-- é¸æ“‡é¡åˆ¥ --</option>
                    <option>äº¤é€š</option>
                    <option>é£²é£Ÿ</option>
                    <option>ä½å®¿</option>
                    <option>é–€ç¥¨</option>
                    <option>è³¼ç‰©</option>
                    <option>å…¶ä»–</option>
                </select>
                
                <input type="text" v-model="expenseForm.name" placeholder="åç¨±/æè¿°" required
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <input type="date" v-model="expenseForm.date" placeholder="æ—¥æœŸ" required
                       class="w-full p-3 border border-gray-300 rounded-lg">

                <input type="number" v-model.number="expenseForm.amount" placeholder="é‡‘é¡ (AUD)" required min="0.01" step="0.01"
                       class="w-full p-3 border border-gray-300 rounded-lg">
                
                <select v-model="expenseForm.payment" class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <option value="" disabled>-- ä»˜æ¬¾æ–¹å¼ --</option>
                    <option>ç¾é‡‘</option>
                    <option>ä¿¡ç”¨å¡</option>
                </select>

                <textarea v-model="expenseForm.notes" placeholder="å‚™è¨»" rows="2"
                          class="w-full p-3 border border-gray-300 rounded-lg"></textarea>
                
                <div class="flex justify-end space-x-3 mt-5">
                    <button type="button" @click="isExpenseModalOpen = false" class="py-2 px-4 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" class="py-2 px-4 color-primary text-white rounded-lg hover:opacity-90">
                        æ–°å¢èŠ±è²»
                    </button>
                </div>
            </form>
        </div>
    </div>
    
</div>

<script>
// -----------------------------------------------------------
// Vue.js 3 æ‡‰ç”¨ç¨‹å¼é‚è¼¯
// -----------------------------------------------------------

const { createApp, ref, computed, reactive, nextTick } = Vue;
const draggable = vuedraggable; // å¼•å…¥ VueDraggable

const app = createApp({
    components: {
        draggable,
    },
    setup() {
        // --- æ ¸å¿ƒç‹€æ…‹ (ä½¿ç”¨ LocalStorage å¯¦ç¾æŒä¹…åŒ–) ---
        const getLocalStorage = (key, defaultValue) => {
            const stored = localStorage.getItem(key);
            return stored ? JSON.parse(stored) : defaultValue;
        };

        const setLocalStorage = (key, value) => {
            localStorage.setItem(key, JSON.stringify(value));
        };

        const tabs = [
            { id: 'schedule', icon: 'location_on' },
            { id: 'info', icon: 'info' },
            { id: 'shopping', icon: 'shopping_basket' },
            { id: 'expense', icon: 'payments' },
        ];
        const currentTab = ref('schedule');
        const currentDayIndex = ref(0);

        // èˆªç­è³‡è¨Š (éœæ…‹è³‡æ–™)
        const flightInfo = reactive({
            depart: { departure_airport_short: 'TPE', departure_airport: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´', departure_time: '23:30', arrival_airport_short: 'MEL', arrival_airport: 'å¢¨çˆ¾æœ¬æ©Ÿå ´', arrival_time: '10:10 (+1)', duration: '8h 40m', flight_num: 'SQ879/VA838' },
            return: { departure_airport_short: 'OOL', departure_airport: 'é»ƒé‡‘æµ·å²¸æ©Ÿå ´', departure_time: '14:50', arrival_airport_short: 'TPE', arrival_airport: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´', arrival_time: '22:35 (+1)', duration: '9h 45m', flight_num: 'VA528/SQ5229' },
        });

        // ä½å®¿è³‡è¨Š (å¯ç·¨è¼¯ï¼Œå¾ LocalStorage è¼‰å…¥)
        const accommodationInfo = reactive(getLocalStorage('accommodationInfo', {
            brisbane: { city: 'å¸ƒé‡Œæ–¯ç­', name: 'å¾…å®š (å¯é›»è©±ä¿®æ”¹)', phone: '', address: '' },
            goldcoast: { city: 'é»ƒé‡‘æµ·å²¸', name: 'å¾…å®š (å¯é›»è©±ä¿®æ”¹)', phone: '', address: '' },
        }));

        const saveAccommodation = () => {
            setLocalStorage('accommodationInfo', accommodationInfo);
            isAccommodationModalOpen.value = false;
            alert('ä½å®¿è³‡è¨Šå·²å„²å­˜ï¼');
        };

        // è¡Œç¨‹è³‡è¨Š (å¾ LocalStorage è¼‰å…¥ï¼Œæˆ–ä½¿ç”¨é è¨­è³‡æ–™)
        const initialItinerary = [
            {
                date: 'Tue 9', activities: [
                    { id: 101, name: 'æŠµé”é»ƒé‡‘æµ·å²¸æ©Ÿå ´ (OOL) - VA528', category: 'èˆªç­', time: '09:40', notes: 'é‡è¦ï¼šéœ€è‡ªè¡Œè¨‚è³¼ Con-X-ion æˆ–è½‰ç«è»Š', location: 'Gold Coast Airport' },
                    { id: 102, name: 'å¸ƒé‡Œæ–¯ç­é…’åº— Check-in/å¯„æ”¾è¡Œæ', category: 'ä½å®¿', time: '12:30', notes: 'åœ°å€ï¼šéœ€ä¿®æ”¹', location: 'Brisbane CBD' },
                    { id: 103, name: 'åˆé¤ & çš‡åè¡— (Queen Street Mall)', category: 'è³¼ç‰©', time: '13:00', price: 'å…è²»', notes: 'é€›å¸‚æ”¿å»³ã€å…è²»ä¸Šé˜æ¨“ï¼ˆéœ€é ç´„ï¼‰', location: 'Queen Street Mall' },
                    { id: 104, name: 'å—å²¸å…¬åœ’ (South Bank Parklands)', category: 'æ™¯é»', time: '15:00', price: 'å…è²»', notes: 'çœ‹ Streets Beach äººé€ æ²™ç˜ & BRISBANE åœ°æ¨™', location: 'South Bank Parklands' },
                    { id: 105, name: 'æ™šé¤ï¼šéœè¯å¾·å²å¯†æ–¯ç¢¼é ­', category: 'ç¾é£Ÿ', time: '18:00', price: '', notes: 'ä½æ–¼æ•…äº‹æ©‹ä¸‹ï¼Œæ°£æ°›æ¥µä½³', location: 'Howard Smith Wharves' },
                ],
                weather: { location: 'å¸ƒé‡Œæ–¯ç­', icon: 'wb_sunny', temp: 25, feels_like: 27 },
            },
            {
                date: 'Wed 10', activities: [
                    { id: 201, name: 'å‡ºç™¼å‰å¾€ Holt Street Wharf', category: 'äº¤é€š', time: '08:30', notes: 'è‡ªè¡Œå‰å¾€ç¢¼é ­æ­èˆ¹', location: 'Holt Street Wharf' },
                    { id: 202, name: 'æ‘©é “å³¶ (æµ·è±šå³¶) ä¸€æ—¥éŠ', category: 'æ™¯é»', time: '10:00 - 21:00', price: 'èˆ¹ç¥¨/å¥—ç¥¨', notes: 'é‡é ­æˆ²ï¼šé¤µé£Ÿé‡ç”Ÿæµ·è±šï¼', location: 'Tangalooma Island Resort' },
                ],
                weather: { location: 'æ‘©é “å³¶', icon: 'cloud', temp: 23, feels_like: 25 },
            },
            {
                date: 'Thu 11', activities: [
                    { id: 301, name: 'James Street (Fortitude Valley)', category: 'æ™¯é»', time: '09:00 - 11:30', price: 'å…è²»', notes: 'å¸ƒé‡Œæ–¯ç­æœ€æ½®è¡—å€ï¼Œäº«å—æ—©åˆé¤', location: 'James Street, Fortitude Valley' },
                    { id: 302, name: 'ç§»å‹•ï¼šå¸ƒé‡Œæ–¯ç­ â†’ é›»å½±ä¸–ç•Œ', category: 'äº¤é€š', time: '12:00 - 13:15', notes: 'ç«è»Šè½‰å·´å£« (Central -> Helensvale -> TX7)', location: 'Warner Bros. Movie World' },
                    { id: 303, name: 'è¯ç´å…„å¼Ÿé›»å½±ä¸–ç•Œ (çœ‹ç§€)', category: 'æ™¯é»', time: '13:30 - 16:30', price: 'é–€ç¥¨', notes: 'å¿…çœ‹ï¼šå¥½èŠå¡¢é£›è»Šç‰¹æŠ€ & æ˜æ˜Ÿå¤§éŠè¡Œ', location: 'Warner Bros. Movie World' },
                    { id: 304, name: 'å…¥ä½é»ƒé‡‘æµ·å²¸é…’åº—', category: 'ä½å®¿', time: '17:00', notes: 'å–å›è¡Œæï¼Œæ­ G:link è¼•è»Œå‰å¾€', location: 'Surfers Paradise' },
                ],
                weather: { location: 'é»ƒé‡‘æµ·å²¸', icon: 'thunderstorm', temp: 28, feels_like: 30 },
            },
            {
                date: 'Fri 12', activities: [
                    { id: 401, name: 'Q1 SkyPoint è§€æ™¯å°', category: 'æ™¯é»', time: '11:00', price: 'é–€ç¥¨', notes: '360åº¦ä¿¯ç°æµ·å²¸ç·š', location: 'SkyPoint Observation Deck' },
                    { id: 402, name: 'ä¼¯åˆ©è§’ (Burleigh Heads)', category: 'æ™¯é»', time: '14:00 - 17:00', price: 'å…è²»', notes: 'çœ‹æµ·é‡é»ï¼æ²¿è‘—æ­¥é“èµ°åˆ° Tumgun Lookout', location: 'Burleigh Heads' },
                    { id: 403, name: 'æ™šé¤ï¼šRick Shores', category: 'ç¾é£Ÿ', time: '17:30', price: 'é«˜åƒ¹ä½', notes: 'å¿…åƒï¼šMoreton Bay Bug Rollã€‚å·²é ç´„?', location: 'Rick Shores' },
                ],
                weather: { location: 'é»ƒé‡‘æµ·å²¸', icon: 'wb_sunny', temp: 26, feels_like: 28 },
            },
            {
                date: 'Sat 13', activities: [
                    { id: 501, name: 'å‰å¾€å¯å€«è³“é‡ç”Ÿå‹•ç‰©åœ’', category: 'äº¤é€š', time: '09:00', notes: 'Check-out å¸¶è¡Œæå» (é–€å£å¯å¯„å­˜)', location: 'Currumbin Wildlife Sanctuary' },
                    { id: 502, name: 'å¯å€«è³“é‡ç”Ÿå‹•ç‰©åœ’ (æŠ±æ¨¹ç†Š)', category: 'æ™¯é»', time: '09:30 - 12:30', price: 'é–€ç¥¨/æŠ±è€ƒæ‹‰è²»ç”¨', notes: 'æ˜†å£«è˜­å°‘æ•¸å¯åˆæ³•æŠ±è€ƒæ‹‰è™•ï¼Œè¨˜å¾—ä¸€é€²åœ’å°±é ç´„!', location: 'Currumbin Wildlife Sanctuary' },
                    { id: 503, name: 'å‰å¾€æ©Ÿå ´ (OOL) è¿”ç¨‹', category: 'äº¤é€š', time: '12:45', notes: 'å‹•ç‰©åœ’åˆ°æ©Ÿå ´åƒ… 10 åˆ†é˜è»Šç¨‹', location: 'Gold Coast Airport' },
                ],
                weather: { location: 'å¯å€«è³“', icon: 'wb_sunny', temp: 27, feels_like: 29 },
            },
        ];
        const itinerary = reactive(getLocalStorage('itinerary', initialItinerary));

        // è³¼ç‰©æ¸…å–® (å¾ LocalStorage è¼‰å…¥)
        const shoppingList = reactive(getLocalStorage('shoppingList', []));
        const shoppingForm = reactive({ name: '', image: null });
        
        // èŠ±è²»è¨˜éŒ„ (å¾ LocalStorage è¼‰å…¥)
        const expenseList = reactive(getLocalStorage('expenseList', []));
        const expenseForm = reactive({
            category: '',
            name: '',
            date: new Date().toISOString().substring(0, 10),
            amount: 0,
            payment: '',
            notes: '',
        });

        // --- è¡Œç¨‹è¨ˆç®—èˆ‡æ“ä½œ ---
        
        // (7) (6) æ¨¡æ“¬äº¤é€šæ™‚é–“è¨ˆç®—
        const transportData = [
            { icon: 'directions_transit', type: 'å¤§çœ¾é‹è¼¸', time: '1h 30m' },
            { icon: 'directions_walk', type: 'æ­¥è¡Œ', time: '15m' },
            { icon: 'directions_car', type: 'é–‹è»Š', time: '30m' },
            { icon: 'schedule', type: 'ç§»å‹•æ™‚é–“', time: '45m' }, // é è¨­
        ];

        const recalculateTransportTimes = () => {
            // é€™å€‹å‡½æ•¸åœ¨å¯¦éš›æ‡‰ç”¨ä¸­æœƒå‘¼å« Google Maps Distance Matrix API
            // é€™è£¡ç”¨éš¨æ©Ÿæ¨¡æ“¬ï¼Œä»¥ç¬¦åˆã€Œæ–°å¢è¡Œç¨‹å¾Œé‡æ–°è¨ˆç®—ã€çš„è¦æ±‚
            itinerary.forEach((day, dayIndex) => {
                for (let i = 0; i < day.activities.length; i++) {
                    const activity = day.activities[i];
                    if (activity.category !== 'èˆªç­') {
                        // æ¨¡æ“¬è¨ˆç®—æ™‚é–“
                        const randomTransport = transportData[Math.floor(Math.random() * transportData.length)];
                        activity.transport = {
                            icon: randomTransport.icon,
                            type: randomTransport.type,
                            time: randomTransport.time
                        };
                    }
                    // Day 1 ç¬¬ä¸€å€‹æ´»å‹•å‰çš„äº¤é€šæ™‚é–“ï¼Œè¦–ç‚ºå‰ä¸€æ—¥(æ©Ÿå ´)åˆ°è©²æ´»å‹•(é…’åº—)
                    if (dayIndex === 0 && i === 0) {
                        activity.transport = { icon: 'directions_transit', type: 'å¤§çœ¾é‹è¼¸', time: '1h 40m' };
                    }
                }
            });
            setLocalStorage('itinerary', itinerary);
        };
        // é¦–æ¬¡è¼‰å…¥æ™‚åŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿åˆå§‹è³‡æ–™æœ‰äº¤é€šæ™‚é–“æ¬„ä½
        recalculateTransportTimes(); 

        const currentDay = computed(() => itinerary[currentDayIndex.value]);

        // (9) Google Maps å°èˆª
        const openGoogleMaps = (location) => {
            if (location) {
                // `dir_action=navigate` æœƒç›´æ¥åœ¨æ‰‹æ©Ÿä¸Šå•Ÿå‹•å°èˆª
                const url = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(location)}`;
                window.open(url, '_blank');
            } else {
                alert('æ­¤è¡Œç¨‹å°šæœªè¨­å®šå°èˆªåœ°é»ã€‚');
            }
        };

        // --- è¡Œç¨‹ç·¨è¼¯ Modal ---
        const isActivityModalOpen = ref(false);
        const editingDayIndex = ref(null);
        const editingActivityIndex = ref(null);
        const activityForm = reactive({ id: null, name: '', category: '', time: '', price: '', notes: '', location: '', transport: {} });

        const openNewActivityModal = () => {
            editingActivityIndex.value = null;
            editingDayIndex.value = currentDayIndex.value;
            Object.assign(activityForm, { id: Date.now(), name: '', category: '', time: '', price: '', notes: '', location: '', transport: {} });
            isActivityModalOpen.value = true;
        };
        
        const editActivity = (dayIndex, activityIndex) => {
            editingDayIndex.value = dayIndex;
            editingActivityIndex.value = activityIndex;
            const activity = itinerary[dayIndex].activities[activityIndex];
            Object.assign(activityForm, activity);
            isActivityModalOpen.value = true;
        };

        const saveActivity = () => {
            if (editingActivityIndex.value === null) {
                // æ–°å¢
                itinerary[editingDayIndex.value].activities.push({ ...activityForm });
            } else {
                // ç·¨è¼¯
                Object.assign(itinerary[editingDayIndex.value].activities[editingActivityIndex.value], activityForm);
            }
            recalculateTransportTimes(); // é‡æ–°è¨ˆç®—äº¤é€šæ™‚é–“
            isActivityModalOpen.value = false;
        };

        const confirmDeleteActivity = () => {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤è¡Œç¨‹ã€Œ${activityForm.name}ã€å—ï¼Ÿ`)) {
                itinerary[editingDayIndex.value].activities.splice(editingActivityIndex.value, 1);
                recalculateTransportTimes(); // é‡æ–°è¨ˆç®—äº¤é€šæ™‚é–“
                isActivityModalOpen.value = false;
            }
        };

        // --- ä½å®¿ç·¨è¼¯ Modal ---
        const isAccommodationModalOpen = ref(false);
        const openAccommodationModal = () => {
            // å…‹éš†ä¸€ä»½è³‡æ–™ä¾›ç·¨è¼¯ï¼Œé¿å…ç›´æ¥ä¿®æ”¹ç‹€æ…‹
            isAccommodationModalOpen.value = true;
        };

        // --- è³¼ç‰©æ¸…å–® Modal ---
        const isShoppingModalOpen = ref(false);
        const openNewShoppingModal = () => {
            Object.assign(shoppingForm, { name: '', image: null });
            isShoppingModalOpen.value = true;
        };

        const handleImageUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
                // ä½¿ç”¨ FileReader è½‰ç‚º Base64 Data URL æ¨¡æ“¬åœ–ç‰‡å„²å­˜
                const reader = new FileReader();
                reader.onload = (e) => {
                    shoppingForm.image = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };

        const addShoppingItem = () => {
            shoppingList.push({ ...shoppingForm });
            setLocalStorage('shoppingList', shoppingList);
            isShoppingModalOpen.value = false;
        };
        
        const removeShoppingItem = (index) => {
             if (confirm(`ç¢ºå®šè¦åˆªé™¤è³¼ç‰©é …ç›®ã€Œ${shoppingList[index].name}ã€å—ï¼Ÿ`)) {
                shoppingList.splice(index, 1);
                setLocalStorage('shoppingList', shoppingList);
             }
        };


        // --- èŠ±è²» Modal ---
        const isExpenseModalOpen = ref(false);
        const openNewExpenseModal = () => {
            // æ¯æ¬¡é–‹å•Ÿæ™‚ï¼Œè‡ªå‹•å¸¶å…¥ç•¶æ—¥æ—¥æœŸ
            Object.assign(expenseForm, {
                category: '',
                name: '',
                date: new Date().toISOString().substring(0, 10),
                amount: 0,
                payment: '',
                notes: '',
            });
            isExpenseModalOpen.value = true;
        };
        
        const addExpense = () => {
            expenseList.push({ ...expenseForm });
            setLocalStorage('expenseList', expenseList);
            isExpenseModalOpen.value = false;
        };

        // (2) ç¸½èŠ±è²»è¨ˆç®—
        const totalExpenses = computed(() => {
            return expenseList.reduce((sum, item) => sum + item.amount, 0);
        });
        
        // --- ç›£è½è³‡æ–™è®ŠåŒ–ä¸¦å„²å­˜ ---
        // ç¢ºä¿ä»»ä½•è³‡æ–™è®Šå‹•å¾Œéƒ½èƒ½å­˜å› LocalStorage
        // Vue 3 çš„ reactive å·²ç¶“æ˜¯æ·±åº¦ç›£è½ï¼Œä½†æˆ‘å€‘éœ€è¦æ‰‹å‹•èª¿ç”¨ setLocalStorage
        // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘åªåœ¨æ–°å¢/ç·¨è¼¯/æ‹–æ›³æ“ä½œå¾Œå„²å­˜ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡ keypress æ™‚å„²å­˜ã€‚


        return {
            tabs,
            currentTab,
            currentDayIndex,
            itinerary,
            currentDay,
            flightInfo,
            accommodationInfo,
            shoppingList,
            expenseList,
            totalExpenses,
            
            isActivityModalOpen,
            activityForm,
            editingActivityIndex,
            openNewActivityModal,
            editActivity,
            saveActivity,
            confirmDeleteActivity,
            recalculateTransportTimes,
            openGoogleMaps,

            isAccommodationModalOpen,
            openAccommodationModal,
            saveAccommodation,
            
            isShoppingModalOpen,
            shoppingForm,
            openNewShoppingModal,
            handleImageUpload,
            addShoppingItem,
            removeShoppingItem,
            
            isExpenseModalOpen,
            expenseForm,
            openNewExpenseModal,
            addExpense,
        };
    }
});

app.mount('#app');
</script>
